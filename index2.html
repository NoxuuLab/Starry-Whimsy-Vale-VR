<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Reality Scene</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-environment-component/dist/aframe-environment-component.min.js"></script>
    
    <script src="light-toggle.js"></script>
</head>
<body>
    <a-scene cursor="rayOrigin:mouse" fog="type: linear; color: #AAA">
        <!-- ASSETS -->
        <a-assets>
            <a-asset-item id="lamp" src="assets/main_scene/ghost-in-the-shell-geisha-mask/source/model.glb"></a-asset-item>
            <audio id="lampSound1" src="assets/main_scene/cricket.mp3" controls aria-label="Cricket Sound"></audio>
        </a-assets>

        <!-- ENVIRONMENT -->
        <a-entity environment="
                fog: 0.8;
                groundColor: #445; 
                preset: dream; 
                groundTexture: none;
                groundColor: #3a3a3a;  
                grid: none;
                groundYScale: 60;
                dressing: none">
        </a-entity>

        <!-- CAMERA -->
        <a-entity id="rig">
            <a-entity camera look-controls position="0 1.6 0"></a-entity>
            <a-cursor raycaster="objects: .interactive"></a-cursor>
        </a-entity>

        <!-- LIGHTS -->
        <!-- Ambient light for the scene -->
        <a-light type="ambient" color="#888"></a-light>

        <!-- LIGHTS WITH SOUND -->
        <a-gltf-model src="#lamp" 
                position="-1 3 -3" 
                animation="property: rotation; to: 0 90 0; loop: true; dur: 10000">
            <a-sound src="#lampSound1" autoplay="false" loop="true"></a-sound>
            <a-entity onclick="toggleSound('lampSound1')"></a-entity>
        </a-gltf-model>
        <a-light type="spot" position="3 5 3" target="#lamp" angle="45" penumbra="0.8" intensity="1"></a-light>




        <!--invisible box-->
        <a-box position="-1 0 -3" depth="1" height="2" width="1" color="red" onclick="toggleSound('lampSound1')" controls aria-label="Toggle Sound"></a-box>

        <a-entity rotation="0 0 0" animation="property: rotation; to: 0 360 0; loop: true; dur: 10000">
          <a-sphere position="5 0 0" color="mediumseagreen"></a-sphere>
        </a-entity>

    </a-scene>

    <script>
        function toggleSound(soundId) {
            var sound = document.getElementById(soundId);

            // Attempt to play the sound after a user gesture
            document.body.addEventListener('click', function() {
                // Check if the Web Audio API is suspended and resume it if needed
                if (typeof sound.context !== 'undefined' && sound.context.state === 'suspended') {
                    sound.context.resume().then(() => {
                        console.log('AudioContext resumed');
                        sound.play();
                    });
                } else {
                    sound.play();
                }

                // Remove the click event listener to avoid multiple attempts
                document.body.removeEventListener('click', arguments.callee);
            });
        }
    </script>
  
</body>
</html>
